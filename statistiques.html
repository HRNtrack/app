<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HRNtrack</title>
    <link rel="icon" type="image/vnd.icon" href="https://i.postimg.cc/Jndw3xZn/IMG-0226f.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6A8C47;
            --primary-dark: #557235;
            --bg-body: #F5F5F0;
            --card-bg: #ffffff;
            --text-main: #1A1A1A;
            --text-sub: #555555;
            --gold: #C6A875;
            --gold-light: #F0EAD6;
            --red: #C0392B;
            --dark-bg: #1A1A1A;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --nav-height-mobile: 80px;
        }

        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            -webkit-font-smoothing: antialiased; 
            display: flex; flex-direction: column; min-height: 100vh;
            padding-bottom: var(--nav-height-mobile); /* Espace pour la nav mobile */
        }

        /* --- HEADER & NAV --- */
        .top-nav {
            background: var(--dark-bg); color: white; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .site-logo { height: 80px; }
        
        /* NAVIGATION DESKTOP (PAR D√âFAUT) */
        .nav-center {
            position: absolute; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.05); padding: 4px;
            border-radius: 12px; display: flex; gap: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 2000;
        }
        .nav-link {
            text-decoration: none; color: #9CA3AF; padding: 6px 16px;
            border-radius: 8px; font-size: 12px; font-weight: 600;
            transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;
        }
        .nav-link:hover { color: white; background: rgba(255, 255, 255, 0.05); }
        .nav-link.active { background: var(--primary); color: white; box-shadow: 0 2px 10px rgba(106, 140, 71, 0.4); }
        
        .nav-right { display: flex; align-items: center; gap: 10px; }

        .lang-toggle {
            display: flex; background: rgba(255,255,255,0.1); border-radius: 20px;
            padding: 2px; cursor: pointer; border: 1px solid rgba(255,255,255,0.2);
        }
        .lang-option {
            padding: 6px 12px; border-radius: 16px; font-size: 11px; font-weight: 700;
            color: #9CA3AF; transition: all 0.3s ease;
        }
        .lang-option.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .btn-auth-trigger {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; 
            padding: 8px 16px; border-radius: 10px; cursor: pointer; font-size: 13px; font-weight: 600; 
            transition: 0.2s; display: flex; align-items: center; gap: 8px; text-decoration: none;
        }
        .btn-auth-trigger:hover { background: rgba(255,255,255,0.2); }
        .btn-auth-trigger.logged-in { background: rgba(106, 140, 71, 0.2); border-color: var(--primary); color: var(--primary); }

        /* --- MOBILE OPTIMIZATION (APP BAR STYLE) --- */
        @media (min-width: 769px) {
            body { padding-bottom: 0; }
        }

        @media (max-width: 768px) {
            .site-logo { display: none; } 
            
            /* Le Header du haut ne garde que les boutons de droite */
            .top-nav {
                justify-content: flex-end; 
                padding: 10px 15px;
            }

            /* La barre de navigation devient une App Bar en bas */
            .nav-center {
                position: fixed; 
                bottom: 0; 
                top: auto; 
                left: 0; 
                transform: none; 
                width: 100%;
                background: #1A1A1A; 
                border-radius: 0;
                border: none;
                border-top: 1px solid rgba(255,255,255,0.1);
                padding: 8px 0 25px 0; 
                justify-content: space-around; 
                box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
                box-sizing: border-box;
                z-index: 2000;
            }

            /* Style des liens en mode Mobile */
            .nav-link {
                flex-direction: column; 
                padding: 0;
                gap: 4px;
                background: transparent !important; 
                box-shadow: none !important;
                color: #6B7280; 
            }

            .nav-link span:first-child { font-size: 20px; }
            .nav-link span:last-child { font-size: 10px; font-weight: 500; }

            .nav-link.active { color: var(--primary); }
            .nav-link:hover { background: transparent; color: white; }
        }

        .container { 
            max-width: 1400px; margin: 30px auto; padding: 0 20px; 
            width: 100%; box-sizing: border-box; flex: 1;
            display: none; 
        }

        #access-denied {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 60vh; text-align: center; padding: 20px;
        }
        .lock-icon { font-size: 60px; margin-bottom: 20px; background: #E5E7EB; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: #6B7280; }
        .btn-login-big { background: var(--primary); color: white; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 600; margin-top: 20px; cursor: pointer; border: none; font-size: 16px; transition: 0.3s; box-shadow: 0 4px 15px rgba(106, 140, 71, 0.4); }

        /* --- BENTO GRID HEADER --- */
        .bento-container {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .bento-card {
            background: white; padding: 25px; border-radius: 24px;
            box-shadow: var(--shadow); position: relative; overflow: visible;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column;
            justify-content: center; cursor: help;
        }
        .bento-card:hover {
            transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        .bento-card.rank-main {
            background: linear-gradient(135deg, #1A1A1A 0%, #2c3e50 100%);
            color: white; border: none;
        }
        .bento-title {
            font-size: 12px; text-transform: uppercase; letter-spacing: 1.5px;
            font-weight: 700; margin-bottom: 10px; opacity: 0.7;
            display: flex; align-items: center; gap: 6px;
        }
        .bento-value { font-size: 32px; font-weight: 800; line-height: 1.1; }
        .bento-sub { font-size: 13px; margin-top: 5px; opacity: 0.8; font-weight: 500; }
        .info-icon { font-size: 14px; opacity: 0.5; }

        /* TOOLTIP POPUP (POSITION EN BAS) */
        .tooltip-box {
            visibility: hidden; width: 220px; background-color: rgba(0, 0, 0, 0.9);
            color: #fff; text-align: center; border-radius: 12px; padding: 12px;
            position: absolute; z-index: 10; 
            top: 115%; left: 50%; transform: translateX(-50%); 
            opacity: 0; transition: opacity 0.3s;
            font-size: 11px; font-weight: 400; line-height: 1.4; pointer-events: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .tooltip-box::after {
            content: ""; position: absolute; 
            bottom: 100%; left: 50%;
            margin-left: -5px; border-width: 5px; border-style: solid;
            border-color: transparent transparent rgba(0, 0, 0, 0.9) transparent;
        }
        
        .bento-card:hover .tooltip-box { visibility: visible; opacity: 1; }

        @media (max-width: 768px) { .bento-container { grid-template-columns: 1fr; } }

        /* --- KPIS GRID --- */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 16px; box-shadow: var(--shadow); text-align: center; transition: transform 0.3s ease; border: 1px solid rgba(0,0,0,0.05); }
        .kpi-card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .kpi-label { font-size: 11px; color: var(--text-sub); text-transform: uppercase; font-weight: 700; margin-bottom: 5px; display: block;}
        .kpi-value { font-size: 24px; font-weight: 800; color: var(--primary); }
        .kpi-sub { font-size: 10px; font-weight: 600; color: var(--text-sub); margin-top: 4px; }

        .chart-section { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px; }
        .chart-card { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); position: relative; display: flex; flex-direction: column; border: 1px solid rgba(0,0,0,0.05); }
        .chart-card.full-width { grid-column: span 2; }
        h2 { font-size: 16px; margin: 0 0 20px 0; color: var(--text-main); border-bottom: 2px solid var(--bg-body); padding-bottom: 10px; }

        .top-list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed #eee; }
        .top-list-item:last-child { border-bottom: none; }
        .top-rank { font-weight: 800; color: #E5E7EB; font-size: 24px; margin-right: 15px; width: 30px;}
        .top-info { flex-grow: 1; }
        .top-name { font-weight: 600; font-size: 14px; display: block; }
        .top-serie { font-size: 11px; color: var(--text-sub); }
        .top-price { font-weight: 700; color: var(--primary); background: rgba(106, 140, 71, 0.1); padding: 4px 8px; border-radius: 6px; font-size: 13px; }

        /* MODALS */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 420px; padding: 25px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); max-height: 90vh; overflow-y: auto; position: relative; }
        .btn-save { width: 100%; background: var(--dark-bg); color: white; border: none; padding: 14px; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .btn-cancel { width: 100%; background: transparent; border: none; color: var(--red); padding: 10px; cursor: pointer; margin-top: 5px; font-size: 12px; font-weight: 600;}
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #E5E7EB; font-family: inherit; font-size: 14px; box-sizing: border-box; }
        .auth-title { text-align: center; font-size: 24px; font-weight: 800; margin-bottom: 20px; color: var(--text-main); }
        .auth-separator { display: flex; align-items: center; margin: 20px 0; color: #9CA3AF; font-size: 12px; }
        .auth-separator::before, .auth-separator::after { content: ""; flex: 1; height: 1px; background: #E5E7EB; margin: 0 10px; }

        @media (max-width: 768px) { .chart-section { grid-template-columns: 1fr; } .chart-card.full-width { grid-column: span 1; } }

        /* --- EXPORT STORY STYLE (DARK MODE) --- */
        #story-container {
            position: fixed; left: -9999px; top: 0;
            width: 1080px; height: 1920px;
            background: #0f0f0f;
            color: white;
            display: flex; flex-direction: column;
            align-items: center; justify-content: space-between;
            padding: 100px 60px; box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            text-align: center; z-index: -1;
        }
        .story-header { margin-bottom: 50px; }
        .story-title { font-size: 50px; color: #888; text-transform: uppercase; letter-spacing: 5px; font-weight: 600; margin-top: 30px; }
        
        .story-main-stat {
            background: #1f1f1f;
            border-radius: 50px; padding: 60px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 100%; box-sizing: border-box;
            border-left: 20px solid #6A8C47; margin-bottom: 60px;
        }
        .story-percent { font-size: 180px; font-weight: 800; color: white; line-height: 1; margin: 20px 0; }
        .story-label { font-size: 40px; color: #6A8C47; font-weight: 600; text-transform: uppercase; }
        
        .story-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; width: 100%; }
        .story-card { 
            background: #1f1f1f;
            border-radius: 40px; padding: 40px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .story-val { font-size: 70px; font-weight: 700; color: white; display: block; line-height:1.1; }
        .story-sub { font-size: 24px; color: #888; text-transform: uppercase; font-weight: 600; margin-top: 15px; display: block;}
        
        .story-footer { font-size: 30px; color: #666; border-top: 2px solid #333; padding-top: 40px; width: 100%; }

        /* FOOTER */
        .site-footer { background-color: var(--dark-bg); color: #9CA3AF; padding: 60px 20px 20px; margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); font-size: 13px; }
        .footer-content { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; }
        .footer-col h4 { color: white; margin: 0 0 15px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .footer-links { list-style: none; padding: 0; }
        .footer-links li { margin-bottom: 8px; }
        .footer-links a { color: #9CA3AF; text-decoration: none; transition: color 0.2s; }
        .footer-links a:hover { color: var(--primary); }
        .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 11px; color: #6B7280; }
    /* √Ä ajouter dans votre balise <style> */
body {
    opacity: 0; /* On cache tout au d√©part */
    transition: opacity 0.3s ease-in-out;
}

body.auth-ready {
    opacity: 1; /* On affiche une fois fix√© */
}

/* On cache les deux conteneurs par d√©faut */
#access-denied, #main-container {
    display: none !important;
}

#snow-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Tr√®s important : permet de cliquer "√† travers" la neige */
    z-index: 9999; /* Par-dessus tout le reste */
}
    </style>
</head>
<body>
<canvas id="snow-canvas"></canvas>
    <nav class="top-nav">
        <div style="display:flex; align-items:center; gap:10px;">
            <a href="index.html"><img src="https://i.postimg.cc/yNdVZYsy/logo1-blanc.png" class="site-logo" alt="Logo"></a>
        </div>
        <div class="nav-center">
            <a href="index.html" class="nav-link"><span>üè†</span> <span data-t="navHome">Accueil</span></a>
            <a href="dashboard.html" class="nav-link"><span>üìã</span> <span data-t="navCollection">Collection</span></a>
            <a href="statistiques.html" class="nav-link active"><span>üìä</span> <span data-t="navStats">Stats</span></a>
            <a href="donateurs.html" class="nav-link"><span>üéÅ</span> <span data-t="navDonors">Dons</span></a>
            <a href="contact.html" class="nav-link"><span>‚úâÔ∏è</span> <span data-t="navContact">Contact</span></a>
        </div>
        <div class="nav-right">
            <a href="https://ko-fi.com/hrntrack" target="_blank" class="btn-auth-trigger" style="margin-right:10px; text-decoration:none;">
                <span>‚òï</span> <span data-t="navSupport">Soutenir</span>
            </a>

            <button class="btn-auth-trigger" onclick="window.exportStory()" style="margin-right:10px;">
                <span>üì∏</span> <span data-t="btnStory">Story</span>
            </button>
            <div class="lang-toggle" onclick="window.toggleLanguage()">
                <div class="lang-option active" id="lang-fr">FR</div>
                <div class="lang-option" id="lang-en">EN</div>
            </div>
            <button id="auth-trigger" class="btn-auth-trigger" onclick="window.toggleAuthModal()">
                <span>üêº</span> <span id="auth-status-text" data-t="authLogin">Connexion</span>
            </button>
        </div>
    </nav>

    <div id="access-denied">
        <div class="lock-icon">üîí</div>
        <h2 style="font-size:24px; margin:0 0 10px 0; color:var(--text-main);" data-t="deniedTitle">Acc√®s Restreint</h2>
        <p style="color:var(--text-sub); max-width:400px; margin:0 auto;" data-t="deniedMsg">Vous devez √™tre connect√© pour acc√©der √† votre collection, g√©rer vos statistiques et sauvegarder vos figurines.</p>
        <button class="btn-login-big" onclick="window.toggleAuthModal()" data-t="deniedBtn">Se connecter maintenant</button>
    </div>

    <div id="main-container" class="container">
        
        <div class="bento-container">
            <div class="bento-card rank-main">
                <div class="bento-title" style="color:var(--gold);">
                    <span data-t="kpiRankTitle">Collector Rank</span> <span class="info-icon">‚ìò</span>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div class="bento-value" id="rank-name">Novice</div>
                        <div class="bento-sub" id="rank-details">Score : 0 pts</div>
                    </div>
                    <div id="rank-emoji" style="font-size:50px;">üå±</div>
                </div>
                <span class="tooltip-box" data-t="tooltipRank">
                    Le Rank augmente avec votre collection :<br>
                    +10 pts / figurine<br>
                    +100 pts / secret<br>
                    +50 pts / s√©rie compl√®te
                </span>
            </div>
        
            <div class="bento-card">
                <div class="bento-title" style="color:var(--text-sub);">
                    <span data-t="kpiAddictTitle">Niveau d'Addiction</span> <span class="info-icon">‚ìò</span>
                </div>
                <div class="bento-value" style="color:var(--red);" id="bento-addict-val">0%</div>
                <div class="bento-sub" id="bento-addict-sub">Sain</div>
                <span class="tooltip-box" data-t="tooltipAddict">
                    Indicateur de passion (ou de folie !).<br>
                    Calcul√© sur une base arbitraire de 150 figurines Hirono.
                </span>
            </div>
        
            <div class="bento-card">
                <div class="bento-title" style="color:var(--text-sub);">
                    <span data-t="kpiPrestigeTitle">Taux de Prestige</span> <span class="info-icon">‚ìò</span>
                </div>
                <div class="bento-value" style="color:var(--gold);" id="bento-prestige-val">0%</div>
                <div class="bento-sub">Secrets / Total</div>
                <span class="tooltip-box" data-t="tooltipPrestige">
                    La raret√© de votre collection.<br>
                    Pourcentage de Secrets Rares par rapport au total de vos figurines.
                </span>
            </div>
        </div>

        <div class="kpi-grid" id="stats-grid">
            </div>

        <div class="chart-section">
            <div class="chart-card full-width">
                <h2 data-t="chartEvo">üìà √âvolution de la Collection (Achats cumul√©s)</h2>
                <div style="position: relative; height: 300px; width: 100%;">
                    <canvas id="chartTimeline"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <div style="display:flex; flex-direction:column; gap:25px;">
                <div class="chart-card">
                    <h2 data-t="chartSeries">üìä Compl√©tion par S√©rie</h2>
                    <div style="height: 500px; overflow-y: auto;">
                        <canvas id="chartSeries" height="600"></canvas>
                    </div>
                </div>
                <div class="chart-card" style="flex-grow: 1;">
                    <h2 data-t="chartTop">üíé Les P√©pites (Top Valeur)</h2>
                    <div id="top-expensive-list">
                        <p style="text-align:center; color:#9CA3AF; font-size:13px; margin-top:20px;" data-t="txtNoPrice">Aucune donn√©e de prix disponible.</p>
                    </div>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:25px;">
                <div class="chart-card">
                    <h2 data-t="chartStatus">üç© √âtat de la Collection</h2>
                    <div style="height: 180px; position: relative; display:flex; justify-content:center;">
                        <canvas id="chartStatus"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h2 data-t="chartMoney">üí∞ Top D√©penses par S√©rie</h2>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="chartMoney"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h2 data-t="chartMonthly">üìÖ D√©penses Mensuelles</h2>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="chartMonthly"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="story-container">
        <div class="story-header">
            <img src="https://i.postimg.cc/yNdVZYsy/logo1-blanc.png" style="width:250px; background:transparent;">
            <div class="story-title">COLLECTION STATS</div>
        </div>

        <div class="story-main-stat">
            <div class="story-label">TOTAL FIGURES</div>
            <div class="story-percent" id="story-total-val">0</div>
            <div style="font-size:35px; color:#888;">Hirono Collection</div>
        </div>

        <div class="story-grid">
            <div class="story-card">
                <span class="story-val" style="color:#C6A875" id="story-secret-val">0</span>
                <span class="story-sub">SECRETS</span>
            </div>
            <div class="story-card">
                <span class="story-val" style="color:#6A8C47" id="story-value-val">0‚Ç¨</span>
                <span class="story-sub">VALUE</span>
            </div>
            
            <div class="story-card">
                <span class="story-val" id="story-top-price" style="color:#fff; font-size:50px;">-</span>
                <span style="font-size:20px; color:#ccc; margin-top:5px; font-weight:500; display:block; max-width:250px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" id="story-top-name">-</span>
                <span class="story-sub" style="color:#C6A875">MOST EXPENSIVE</span>
            </div>

            <div class="story-card">
                <span class="story-val" style="color:#C0392B" id="story-wish-val">0</span>
                <span class="story-sub">WISHLIST</span>
            </div>
        </div>

        <div class="story-footer">
            <p>Track yours on <strong>hrntrack.com</strong></p>
            <p id="story-date" style="font-size:24px; margin-top:10px;"></p>
        </div>
    </div>

    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content" style="text-align:center;">
            <div class="auth-title" data-t="authLogin">Connexion</div>
            <p style="color:#6B7280; font-size:13px; margin-bottom:20px;" data-t="authDesc">Sauvegardez votre collection dans le cloud.</p>
            <input type="email" id="auth-email" placeholder="Email" style="margin-bottom:10px;">
            <input type="password" id="auth-pass" placeholder="Mot de passe" style="margin-bottom:20px;">
            <button class="btn-save" onclick="window.handleLogin()" style="background:var(--primary);" data-t="btnLogin">Se connecter</button>
            <div class="auth-separator">OU</div>
            <button class="btn-save" onclick="window.handleRegister()" style="background:white; color:var(--text-main); border:1px solid #E5E7EB;" data-t="btnRegister">Cr√©er un compte</button>
            <button class="btn-cancel" onclick="window.toggleAuthModal()" data-t="btnCancel">Annuler</button>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-col">
                <img src="https://i.postimg.cc/yNdVZYsy/logo1-blanc.png" alt="HRNtrack" style="height: 100px; margin-bottom: 15px; opacity: 0.8;">
                <p data-t="footerDesc">L'outil ultime pour suivre votre collection Hirono.</p>
            </div>
            <div class="footer-col">
                <h4 data-t="footerNav">Navigation</h4>
                <ul class="footer-links">
                    <li><a href="index.html" data-t="navHome">Accueil</a></li>
                    <li><a href="dashboard.html" data-t="navCollection">Collection</a></li>
                    <li><a href="statistiques.html" data-t="navStats">Statistiques</a></li>
                    <li><a href="donateurs.html" data-t="navDonors">Donateurs</a></li>
                    <li><a href="contact.html" data-t="navContact">Contact</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 data-t="footerAbout">√Ä propos</h4>
                <p data-t="footerDisclaimer">Ce site est un projet de fan (Fanmade).<br>Nous ne sommes pas affili√©s √† <strong>POP MART</strong>.</p>
            </div>
        </div>
        <div class="footer-bottom">&copy; 2025 HRNtrack. Fait avec passion.</div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyB1vHxCeB4IfNWpTibp64WgNP30KlXMaAc", authDomain: "hrntrack-1cfe3.firebaseapp.com", projectId: "hrntrack-1cfe3", storageBucket: "hrntrack-1cfe3.firebasestorage.app", messagingSenderId: "1059019333826", appId: "1:1059019333826:web:fa184b796b847cc0f2db5b" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- I18N DICTIONNAIRE ---
        const translations = {
            fr: {
                navHome: "Accueil", navCollection: "Collection", navStats: "Stats", navDonors: "Dons", navContact: "Contact", navSupport: "Soutenir",
                authLogin: "Connexion", authAccount: "Mon Compte", authDesc: "Sauvegardez votre collection dans le cloud.",
                btnLogin: "Se connecter", btnRegister: "Cr√©er un compte", btnCancel: "Annuler",
                footerDesc: "L'outil ultime pour suivre votre collection Hirono.", footerNav: "Navigation", footerAbout: "√Ä propos", footerDisclaimer: "Ce site est un projet de fan (Fanmade). Nous ne sommes pas affili√©s √† POP MART.",
                kpiTotal: "Total Figurines", kpiInvest: "Investissement", kpiSecretsFound: "Secrets Trouv√©s",
                kpiHeart: "Coup de C≈ìur", kpiAvgPrice: "Prix Moyen", kpiComplete: "S√©ries Compl√®tes", kpiWish: "Wishlist", 
                btnStory: "Story Insta",
                chartEvo: "üìà √âvolution de la Collection (Achats)", chartSeries: "üìä Compl√©tion par S√©rie", chartTop: "üíé Les P√©pites (Top Valeur)", chartStatus: "üç© √âtat de la Collection", chartMoney: "üí∞ Top D√©penses par S√©rie", chartMonthly: "üìÖ D√©penses Mensuelles",
                txtNoPrice: "Aucune donn√©e de prix disponible.",
                deniedTitle: "Acc√®s Restreint", deniedMsg: "Vous devez √™tre connect√© pour acc√©der √† votre collection, g√©rer vos statistiques et sauvegarder vos figurines.", deniedBtn: "Se connecter maintenant",
                
                // NOUVEAUX CHAMPS BENTO & POPUPS (FR)
                kpiRankTitle: "Collector Rank",
                kpiAddictTitle: "Niveau d'Addiction",
                kpiPrestigeTitle: "Taux de Prestige",
                tooltipRank: "Le Rank augmente avec votre collection :<br>+10 pts / figurine<br>+100 pts / secret<br>+50 pts / s√©rie compl√®te",
                tooltipAddict: "Indicateur de passion (ou de folie !).<br>Calcul√© sur une base arbitraire de 150 figurines Hirono.",
                tooltipPrestige: "La raret√© de votre collection.<br>Pourcentage de Secrets Rares par rapport au total de vos figurines."
            },
            en: {
                navHome: "Home", navCollection: "Collection", navStats: "Stats", navDonors: "Donations", navContact: "Contact", navSupport: "Support",
                authLogin: "Login", authAccount: "My Account", authDesc: "Save your collection to the cloud.",
                btnLogin: "Log In", btnRegister: "Sign Up", btnCancel: "Cancel",
                footerDesc: "The ultimate tool to track your Hirono collection.", footerNav: "Navigation", footerAbout: "About", footerDisclaimer: "This is a fanmade project. We are not affiliated with POP MART.",
                kpiTotal: "Total Figures", kpiInvest: "Investment", kpiSecretsFound: "Secrets Found",
                kpiHeart: "Top Pick", kpiAvgPrice: "Avg. Price", kpiComplete: "Complete Series", kpiWish: "Wishlist", 
                btnStory: "Insta Story",
                chartEvo: "üìà Collection Evolution (Purchases)", chartSeries: "üìä Series Completion", chartTop: "üíé Top Value Items", chartStatus: "üç© Collection Status", chartMoney: "üí∞ Top Spending by Series", chartMonthly: "üìÖ Monthly Spending",
                txtNoPrice: "No price data available.",
                deniedTitle: "Access Restricted", deniedMsg: "You must be logged in to access your collection, manage stats, and save figures.", deniedBtn: "Log in now",

                // NOUVEAUX CHAMPS BENTO & POPUPS (EN)
                kpiRankTitle: "Collector Rank",
                kpiAddictTitle: "Addiction Level",
                kpiPrestigeTitle: "Prestige Rate",
                tooltipRank: "Rank increases with your collection:<br>+10 pts / figure<br>+100 pts / secret<br>+50 pts / complete series",
                tooltipAddict: "Passion (or madness!) indicator.<br>Calculated based on an arbitrary goal of 150 Hirono figures.",
                tooltipPrestige: "The rarity of your collection.<br>Percentage of Secret Rares compared to your total figures."
            }
        };

        let currentLang = localStorage.getItem('HRN_LANG') || 'fr';

        window.toggleLanguage = () => {
            currentLang = (currentLang === 'fr') ? 'en' : 'fr';
            localStorage.setItem('HRN_LANG', currentLang);
            updateUIText();
            if(myCollection.length > 0 && document.getElementById('main-container').style.display !== 'none') renderStats(myCollection);
        };

        function updateUIText() {
            if(currentLang === 'fr') {
                document.getElementById('lang-fr').classList.add('active');
                document.getElementById('lang-en').classList.remove('active');
            } else {
                document.getElementById('lang-fr').classList.remove('active');
                document.getElementById('lang-en').classList.add('active');
            }
            const t = translations[currentLang];
            document.querySelectorAll('[data-t]').forEach(el => {
                const key = el.getAttribute('data-t');
                if(t[key]) {
                    // Utilisation de innerHTML au lieu de innerText pour supporter les <br>
                    el.innerHTML = t[key]; 
                }
            });
            const user = auth.currentUser;
            const btnText = document.getElementById('auth-status-text');
            if(btnText) btnText.innerText = user ? t.authAccount : t.authLogin;
        }

        window.toggleAuthModal = () => {
            const el = document.getElementById('auth-modal');
            el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
        };

        window.handleLogin = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            try { await signInWithEmailAndPassword(auth, email, pass); window.toggleAuthModal(); } catch(e) { alert("Erreur: " + e.message); }
        };

        window.handleRegister = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            try { await createUserWithEmailAndPassword(auth, email, pass); window.toggleAuthModal(); } catch(e) { alert("Erreur: " + e.message); }
        };

        window.handleLogout = async () => {
            if(confirm("Voulez-vous vraiment vous d√©connecter ?")) { await signOut(auth); location.reload(); }
        };
        
        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) { event.target.style.display = "none"; }
        }

        // --- BASE DATA ---
        const baseData = [
            {"ID":"CIT-BELONG","Name":"Belonging","Serie":"City of Mercy","Secret Rare":"Yes"},
            {"ID":"CIT-COMFOR","Name":"Comfortably Numb","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CIT-ECHO","Name":"Echo","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CIT-FALLEN","Name":"Fallen Angel","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CIT-HEALER","Name":"Healer","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CIT-INSIGH","Name":"Insight","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CIT-THE OT","Name":"The Other","Serie":"City of Mercy","Secret Rare":"No"},
            {"ID":"CLO-ALIENE","Name":"Alienegra","Serie":"Clot","Secret Rare":"No"},
            {"ID":"CLO-CHINES","Name":"Chinese","Serie":"Clot","Secret Rare":"No"},
            {"ID":"CLO-KUNG F","Name":"Kung Fu","Serie":"Clot","Secret Rare":"No"},
            {"ID":"CLO-NING N","Name":"Ning Ning","Serie":"Clot","Secret Rare":"Yes"},
            {"ID":"CLO-SILK R","Name":"Silk Royale","Serie":"Clot","Secret Rare":"No"},
            {"ID":"CLO-TERRAC","Name":"Terracotta Army","Serie":"Clot","Secret Rare":"No"},
            {"ID":"CLO-YIN-YA","Name":"Yin-yang","Serie":"Clot","Secret Rare":"No"},
            {"ID":"ECH-BACK O","Name":"Back Off","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-BREAKO","Name":"Breakout Plan","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-CAUGHT","Name":"Caught You","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-DAYDRE","Name":"Daydreaming","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-EATEN","Name":"Eaten","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-GET LU","Name":"Get Lucky","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-HIDING","Name":"Hiding Behing You","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-JOURNE","Name":"Journey in the Rain","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-KNIGHT","Name":"Knight","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-NEVER","Name":"Never Growing Up","Serie":"Echo","Secret Rare":"Yes"},
            {"ID":"ECH-PIECES","Name":"Pieces of Memory","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-SOUL C","Name":"Soul Connection","Serie":"Echo","Secret Rare":"No"},
            {"ID":"ECH-STAYIN","Name":"Staying Up","Serie":"Echo","Secret Rare":"No"},
            {"ID":"LIT-BIRDMA","Name":"Birdman","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-BOILIN","Name":"Boiling Frog","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-DESTRO","Name":"Destroyer","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-FLOAT","Name":"Float","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-LOOSE","Name":"Loose Fish","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-MANACL","Name":"Manacle","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-PERSON","Name":"Persona","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-PRETEN","Name":"Pretender","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-RAGPIC","Name":"Ragpicker","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-ROBOT","Name":"Robot","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-THE AV","Name":"The Aviator","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-THE PR","Name":"The Protector","Serie":"Little Mischief","Secret Rare":"No"},
            {"ID":"LIT-UNKNOW","Name":"Unknown Journey","Serie":"Little Mischief","Secret Rare":"Yes"},
            {"ID":"LPP-THE BU","Name":"The Businessman","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE CO","Name":"The Conceited","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE FO","Name":"The Fox","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE GE","Name":"The Geographer","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE KI","Name":"The King","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE LA","Name":"The Lamplighter","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THE LI","Name":"The Little Prince","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"LPP-THELIV","Name":"The Little Prince (Variant)","Serie":"Le Petit Prince","Secret Rare":"Yes"},
            {"ID":"LPP-THE PI","Name":"The Pilot","Serie":"Le Petit Prince","Secret Rare":"Yes"},
            {"ID":"LPP-THE RO","Name":"The Rose","Serie":"Le Petit Prince","Secret Rare":"No"},
            {"ID":"MIM-BLIND","Name":"Blind","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-DESTRO","Name":"Destroyer","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-DEVILR","Name":"Devilry","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-DRIFTE","Name":"Drifter","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-FOOL","Name":"Fool","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-GUARDI","Name":"Guardian","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-PATIEN","Name":"Patience","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-POEM","Name":"Poem","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-PRISON","Name":"Prison","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-SECREC","Name":"Secrecy","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-SEEKER","Name":"Seeker","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MIM-SILENT","Name":"Silent","Serie":"Mime","Secret Rare":"Yes"},
            {"ID":"MIM-UNSPOK","Name":"Unspoken","Serie":"Mime","Secret Rare":"No"},
            {"ID":"MON-CREEPY","Name":"Creepy Clown","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"MON-DOCTOR","Name":"Doctor Beak","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"MON-GRIM R","Name":"Grim Reaper","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"MON-KILLER","Name":"Killer Bunny","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"MON-THE DI","Name":"The Disembodied","Serie":"Monsters' Carnival","Secret Rare":"Yes"},
            {"ID":"MON-VAMPIR","Name":"Vampire","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"MON-ZOMBIE","Name":"Zombie","Serie":"Monsters' Carnival","Secret Rare":"No"},
            {"ID":"RES-BURST","Name":"Burst","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-COSTUM","Name":"Costume","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-DROWNI","Name":"Drowning","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-FADING","Name":"Fading","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-HEALIN","Name":"Healing","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-PARADI","Name":"Paradise Lost","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-PARASI","Name":"Parasite","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-PUPPET","Name":"Puppet","Serie":"Reshape","Secret Rare":"Yes"},
            {"ID":"RES-VOYAGE","Name":"Voyage","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"RES-WOODCA","Name":"Woodcarving","Serie":"Reshape","Secret Rare":"No"},
            {"ID":"ROA-CITY D","Name":"City Dust Afloat","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"ROA-FROSTF","Name":"Frostfall Hour","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"ROA-GREY G","Name":"Grey Gravel","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"ROA-HIGHWA","Name":"Highway Imprint","Serie":"Road Journal","Secret Rare":"Yes"},
            {"ID":"ROA-INTO F","Name":"Into Fogwild","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"ROA-LOST I","Name":"Lost In the Night","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"ROA-WOVEN","Name":"Woven Woods","Serie":"Road Journal","Secret Rare":"No"},
            {"ID":"SHE-ALIEN","Name":"Alien","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-BIRDCA","Name":"Birdcage","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-BIRDY","Name":"Birdy","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-CABIN","Name":"Cabin","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-CANDLE","Name":"Candleholder","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-CIRCUS","Name":"Circus","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-FORT","Name":"Fort","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-MANDEL","Name":"Mandel Clock","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-POET","Name":"Poet","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-STUFFE","Name":"Stuffed Bear","Serie":"Shelter","Secret Rare":"Yes"},
            {"ID":"SHE-SUNNY","Name":"Sunny Doll","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-TRAFFI","Name":"Traffic Cone","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SHE-WARRIO","Name":"Warrior","Serie":"Shelter","Secret Rare":"No"},
            {"ID":"SPE- SIMPE","Name":"Simper","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE- SIM200","Name":"Simper","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-3, 2,","Name":"3, 2, 1 Boom!","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-BANGER","Name":"Banger","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-BEAR V","Name":"Bear Vinyl Plush Doll","Serie":"Special Plush Doll","Secret Rare":"No"},
            {"ID":"SPE-BEIJIN","Name":"Beijing Swift","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-BIRD B","Name":"Bird Black","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-BIRD P","Name":"Bird Pink","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-CERFEA","Name":"Ceramic Feather","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-CHENG","Name":"Cheng Du","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-COFFEE","Name":"Coffee Figure","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-DEAD S","Name":"Dead Silence Figure","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-DOLL P","Name":"Doll Panda","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-ELEPHA","Name":"Elephant in the Room","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-ELEPWO","Name":"Elephant in the Room Wood Color","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-ELEP99","Name":"Elephant in the Room 99","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-ELE500","Name":"Elephant in the Room Wood Color 500","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-ENDLES","Name":"Endless Enjoyment","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-GARY B","Name":"Gary Baseman","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-HIRONO","Name":"Hirono x Qoo","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-HIRONO","Name":"Hirono Vans Skateboarder","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-INTERV","Name":"Intervals of Silence","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-KEITH","Name":"Keith Haring","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-KEIT2","Name":"Keith Haring","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-LISTEN","Name":"Listening","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-LIVING","Name":"Living Wild-Fight for Joy Plush Doll","Serie":"Special Plush Doll","Secret Rare":"No"},
            {"ID":"SPE-MERRY","Name":"Merry Christmas Mr.Hirono","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-POLAR","Name":"Polar Symbiosis","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-POLAR","Name":"Polar Coexistence","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-POPMAR","Name":"Popmart Spotlight Hirono Misfit","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-PRANKS","Name":"Prankster Loong","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-PRANKS","Name":"Prankster Loong Green Variant","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-RESHAP","Name":"Reshape","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-SANDRES","Name":"Sand ofReshaping","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-SAD CL","Name":"Sad Clown","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-SAYING","Name":"Saying","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-SEARCH","Name":"Search for Aliens","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-SEE YO","Name":"See You","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-SEEING","Name":"Seeing","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-SHANGH","Name":"Shanghai Monster","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-SNOOPY","Name":"Snoopy Peanuts","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-SOLITAR","Name":"Solitary Hermit","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-STEFSUN","Name":"Stefanie Sun Weather With You","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-STEFAN","Name":"Stefanie Sun AUT NIHILO","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-THE FL","Name":"The Fleeting Years","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-THE KI","Name":"The King (France Exclusive)","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-THE LI","Name":"The Little Prince","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-THE PI","Name":"The Pianist","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-THE UF","Name":"THE UFO CHASER Hirono x Journey to the West Figure","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-UFO CH","Name":"UFO Chaser Hirono 100%","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-WISH L","Name":"Wish List","Serie":"Special Blind Box","Secret Rare":"No"},
            {"ID":"SPE-WISHES","Name":"Wishes Come True","Serie":"Special Blind Box","Secret Rare":"Yes"},
            {"ID":"THE-AMNESI","Name":"Amnesia","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-BEING","Name":"Being Alive","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-CUCKOO","Name":"Cuckoo","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-DREAMI","Name":"Dreaming","Serie":"The Other One","Secret Rare":"Yes"},
            {"ID":"THE-MARION","Name":"Marionette","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-NOWHER","Name":"Nowhere Safe","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-RAVING","Name":"Raving","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-STARIN","Name":"Staring","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-THE CR","Name":"The Crow","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-THE FO","Name":"The Fox","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-THE GH","Name":"The Ghost","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-THE MO","Name":"The Monster","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"THE-VAGRAN","Name":"Vagrancy","Serie":"The Other One","Secret Rare":"No"},
            {"ID":"SPE-PERSON","Name":"Persona","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-HALO23","Name":"Halloween Special 2023","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-HALOCH","Name":"Halloween Special China","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-SUMWIND","Name":"Summer Time Wind Blows","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-FLOMARK","Name":"Floating Market","Serie":"Special Blister","Secret Rare":"No"},
            {"ID":"SPE-ORANGE","Name":"Orange Pop","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-BACKTO","Name":"Back to Play","Serie":"Special Edition","Secret Rare":"No"},
            {"ID":"SPE-SNOWFALL","Name":"Snowfall Alley","Serie":"Special Pop Blocks","Secret Rare":"No"},
            {"ID":"SPE-EMBRANY","Name":"Embracing New Year","Serie":"Special Pop Blocks","Secret Rare":"Yes"},
            {"ID":"SPE-POPBEAN","Name":"Pop Bean","Serie":"Special Pop Bean","Secret Rare":"No"},
            {"ID":"SPE-LITPRANK","Name":"Little Prank","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-SKYWARD","Name":"Skyward","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-CHUCKY","Name":"Chucky","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-BEFSNOW","Name":"Before Snow Melts","Serie":"Special 200%","Secret Rare":"No"},
            {"ID":"SPE-BEFSNOWS","Name":"Before Snow Melts","Serie":"Special 200%","Secret Rare":"Yes"},
            {"ID":"SPE-SHELTER","Name":"Shelter","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-LOSTPARA","Name":"Lost Paradise Scilpture","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-TERRAARMY","Name":"Terracotta Army Sculpture","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-STONEFEA","Name":"Stone Feather Sculpture","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-DRIFTBO","Name":"Drift Bottle Ornament","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-YYCERAM","Name":"Yin-Yang Ceramic Sculpture","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-YYCEBUR","Name":"Yin-Yang Incense Burner","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-UNKJOUR","Name":"Unknown Journey","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"SPE-RESHSCULP","Name":"Reshape Sculpture 399","Serie":"Limited Edition","Secret Rare":"No"},
            {"ID":"CIT-WANDER","Name":"Wandering","Serie":"City of Mercy","Secret Rare":"No"}
        ];

        let myCollection = [];

        // --- AUTH & LOAD ---
        onAuthStateChanged(auth, async (user) => {
            const btn = document.getElementById('auth-trigger');
            updateUIText();

            if (user) {
                // UI: CONNECT√â
                btn.classList.add('logged-in'); 
                // MODIFICATION ICI : REDIRECTION VERS COMPTE.HTML
                btn.onclick = () => window.location.href = "compte.html";

                // Afficher le Dashboard, cacher l'√©cran verrouill√©
                document.getElementById('access-denied').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';

                const docRef = doc(db, "users", user.uid);
                try {
                    const snap = await getDoc(docRef);
                    if (snap.exists()) {
                        const data = snap.data();
                        const cloudData = (data && Array.isArray(data.collection)) ? data.collection : [];
                        myCollection = baseData.map(baseItem => {
                            const savedItem = cloudData.find(i => i.ID === baseItem.ID);
                            if (savedItem) {
                                return {
                                    ...baseItem,
                                    Status: savedItem.Status || baseItem.Status,
                                    Quantity: savedItem.Quantity,
                                    "Purchase price": savedItem["Purchase price"],
                                    "Purchase date": savedItem["Purchase date"],
                                    "Secret Rare": baseItem["Secret Rare"] 
                                };
                            }
                            return baseItem;
                        });
                    } else {
                        myCollection = [...baseData];
                    }
                } catch (error) { myCollection = [...baseData]; }
                
                renderStats(myCollection);

            } else {
                // UI: D√âCONNECT√â -> ACC√àS RESTREINT
                btn.classList.remove('logged-in');
                btn.onclick = () => window.toggleAuthModal();
                document.getElementById('access-denied').style.display = 'flex';
                document.getElementById('main-container').style.display = 'none';
                myCollection = []; 
            }
        });

        function renderStats(data) {
            if(!data || data.length === 0) return;

            let totalItems = 0;
            let totalValue = 0;
            let secretsCount = 0;
            let seriesStats = {};
            let timelineData = {};
            let monthlyData = {};
            let statusCounts = { owned: 0, wish: 0, missing: 0 };
            
            data.forEach(item => {
                const q = parseInt(item.Quantity) || 0;
                const p = parseFloat(item["Purchase price"]) || 0;
                const s = item.Serie;
                const status = item.Status;
                const date = item["Purchase date"];

                if(!seriesStats[s]) seriesStats[s] = { total: 0, owned: 0, spent: 0 };
                seriesStats[s].total++;

                if(status === 'Poss√©d√©') {
                    statusCounts.owned++;
                    totalItems += q;
                    totalValue += (p * q);
                    seriesStats[s].owned++;
                    seriesStats[s].spent += (p * q);
                    if(item["Secret Rare"] === "Yes") secretsCount++;

                    if(date) {
                        if(!timelineData[date]) timelineData[date] = 0;
                        timelineData[date] += q;
                        const monthKey = date.substring(0, 7);
                        if(!monthlyData[monthKey]) monthlyData[monthKey] = 0;
                        monthlyData[monthKey] += (p * q);
                    }
                } else if (status === 'Recherch√©') {
                    statusCounts.wish++;
                } else {
                    statusCounts.missing++;
                }
            });

            // Locale logic
            const locale = currentLang === 'fr' ? 'fr-FR' : 'en-US';
            const currency = currentLang === 'fr' ? 'EUR' : 'USD';

            // --- CALCULS STATS ---
            const addiction = Math.min(100, Math.round((totalItems / 150) * 100)); // Base arbitraire de 150
            const prestige = totalItems > 0 ? Math.round((secretsCount / totalItems) * 100) : 0;
            const fullyComplete = Object.values(seriesStats).filter(s => s.owned >= 12).length; // Seuil arbitraire de 12
            const avgPrice = totalItems > 0 ? (totalValue / totalItems) : 0;
            
            // Heart Pick (S√©rie favorite)
            let fav = "-"; let max = 0;
            Object.entries(seriesStats).forEach(([name, s]) => { if(s.owned > max){ max = s.owned; fav = name; }});

            // Score et Rang
            const score = (totalItems * 10) + (secretsCount * 100) + (fullyComplete * 50);
            let rName = "Novice"; let emoji = "üå±";
            if(score > 2000) { rName = "Legend"; emoji = "üåå"; }
            else if(score > 1000) { rName = "Master"; emoji = "üé≠"; }
            else if(score > 500) { rName = "Collector"; emoji = "üíé"; }
            
            // --- MISE A JOUR DU BENTO HEADER (Top) ---
            document.getElementById('rank-name').innerText = rName;
            document.getElementById('rank-emoji').innerText = emoji;
            document.getElementById('rank-details').innerText = "Score : " + score + " pts";
            
            document.getElementById('bento-addict-val').innerText = addiction + "%";
            document.getElementById('bento-addict-sub').innerText = addiction > 50 ? (currentLang==='fr'?"Passionn√©":"Fanatic") : (currentLang==='fr'?"Sain":"Healthy");
            
            document.getElementById('bento-prestige-val').innerText = prestige + "%";

            // --- INJECTION DES CARTES RESTANTES (Grid) ---
            const cardsData = [
                { id: "kpiTotal", val: totalItems, sub: currentLang==='fr'?"Figurines":"Items" },
                { id: "kpiInvest", val: totalValue.toLocaleString(locale, {style:'currency', currency:currency}), sub: currentLang==='fr'?"Valeur":"Value" },
                { id: "kpiSecretsFound", val: secretsCount, sub: currentLang==='fr'?"Secrets":"Secrets", color: "var(--gold)" },
                { id: "kpiHeart", val: fav, sub: currentLang==='fr'?"Favorite":"Best" },
                { id: "kpiAvgPrice", val: avgPrice.toLocaleString(locale, {style:'currency', currency:currency}), sub: "Unit" },
                { id: "kpiComplete", val: fullyComplete, sub: "100%" },
                { id: "kpiWish", val: statusCounts.wish, sub: "Wanted", color: "var(--red)" }
            ];

            const grid = document.getElementById('stats-grid');
            grid.innerHTML = cardsData.map(c => `
                <div class="kpi-card">
                    <span class="kpi-label" data-t="${c.id}">${translations[currentLang][c.id]}</span>
                    <span class="kpi-value" style="${c.color ? 'color:'+c.color : ''}">${c.val}</span>
                    <div class="kpi-sub">${c.sub}</div>
                </div>
            `).join('');

            // --- TOP 3 EXPENSIVE ---
            const topExpensive = data
                .filter(i => i.Status === 'Poss√©d√©' && parseFloat(i["Purchase price"]) > 0)
                .sort((a,b) => parseFloat(b["Purchase price"]) - parseFloat(a["Purchase price"]))
                .slice(0, 3);

            const topListEl = document.getElementById('top-expensive-list');
            if(topExpensive.length > 0) {
                let html = '';
                topExpensive.forEach((item, index) => {
                    const price = parseFloat(item["Purchase price"]).toLocaleString(locale, {style:'currency', currency: currency});
                    html += `
                        <div class="top-list-item">
                            <span class="top-rank">${index + 1}</span>
                            <div class="top-info">
                                <span class="top-name">${item.Name}</span>
                                <span class="top-serie">${item.Serie}</span>
                            </div>
                            <span class="top-price">${price}</span>
                        </div>
                    `;
                });
                topListEl.innerHTML = html;
            } else {
                 const t = translations[currentLang];
                 topListEl.innerHTML = `<p style="text-align:center; color:#9CA3AF; font-size:13px; margin-top:20px;">${t.txtNoPrice}</p>`;
            }

            // --- GRAPHIQUES ---
            updateCharts(timelineData, seriesStats, statusCounts, monthlyData);
        }

        function updateCharts(timelineData, seriesStats, statusCounts, monthlyData) {
            Chart.helpers.each(Chart.instances, instance => instance.destroy());

            // Timeline
            const sortedDates = Object.keys(timelineData).sort();
            let cumulative = 0;
            const timelinePoints = sortedDates.map(date => { cumulative += timelineData[date]; return cumulative; });

            new Chart(document.getElementById('chartTimeline'), {
                type: 'line',
                data: { labels: sortedDates, datasets: [{ label: 'Total', data: timelinePoints, borderColor: '#6A8C47', backgroundColor: 'rgba(106, 140, 71, 0.1)', fill: true, tension: 0.3 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });

            // Series
            const seriesLabels = Object.keys(seriesStats);
            const seriesCompletionData = seriesLabels.map(s => Math.round((seriesStats[s].owned / seriesStats[s].total) * 100));
            new Chart(document.getElementById('chartSeries'), {
                type: 'bar',
                data: { labels: seriesLabels, datasets: [{ label: '%', data: seriesCompletionData, backgroundColor: '#6A8C47', borderRadius: 4 }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { max: 100 } } }
            });

            // Status
            const labelsStatus = currentLang === 'fr' ? ['Poss√©d√©es', 'Wishlist', 'Manquantes'] : ['Owned', 'Wishlist', 'Missing'];
            new Chart(document.getElementById('chartStatus'), {
                type: 'doughnut',
                data: { labels: labelsStatus, datasets: [{ data: [statusCounts.owned, statusCounts.wish, statusCounts.missing], backgroundColor: ['#6A8C47', '#C6A875', '#E5E7EB'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '65%', plugins: { legend: { position: 'right' } } }
            });

            // Money
            const sortedMoney = Object.entries(seriesStats).sort((a,b) => b[1].spent - a[1].spent).slice(0, 5);
            new Chart(document.getElementById('chartMoney'), {
                type: 'bar',
                data: { labels: sortedMoney.map(i => i[0]), datasets: [{ label: currentLang === 'fr' ? 'D√©penses' : 'Spent', data: sortedMoney.map(i => i[1].spent), backgroundColor: '#C6A875', borderRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Monthly
            const sortedMonths = Object.keys(monthlyData).sort();
            new Chart(document.getElementById('chartMonthly'), {
                type: 'bar',
                data: { labels: sortedMonths, datasets: [{ label: currentLang === 'fr' ? 'D√©penses (‚Ç¨)' : 'Spending ($)', data: sortedMonths.map(m => monthlyData[m]), backgroundColor: '#C0392B', borderRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });
        }

        // --- EXPORT STORY LOGIC (DARK + TOP ITEM) ---
        window.exportStory = async () => {
            const btn = document.querySelector('button[onclick="window.exportStory()"] span:last-child');
            const originalText = btn.innerText;
            btn.innerText = "‚è≥";

            // 1. R√©cup√©rer les donn√©es depuis la grille
            const grid = document.getElementById('stats-grid');
            // Check si la grille est remplie (au moins quelques √©l√©ments)
            if(grid.children.length < 5) return; 

            // Note: Indices chang√©s car on a retir√© 2 cartes de la grille pour les mettre en haut
            // Index 0 = Total, Index 1 = Invest, Index 2 = Secrets, Index 6 = Wishlist
            document.getElementById('story-total-val').innerText = grid.children[0].querySelector('.kpi-value').innerText;
            document.getElementById('story-value-val').innerText = grid.children[1].querySelector('.kpi-value').innerText;
            document.getElementById('story-secret-val').innerText = grid.children[2].querySelector('.kpi-value').innerText;
            document.getElementById('story-wish-val').innerText = grid.children[6].querySelector('.kpi-value').innerText;
            
            // 2. TROUVER LA FIGURINE LA PLUS CH√àRE
            let topItemName = "-";
            let topItemPrice = "-";
            
            if(myCollection && myCollection.length > 0) {
                // Filtrer par 'Poss√©d√©' et trier par prix d√©croissant
                const sorted = myCollection
                    .filter(i => i.Status === 'Poss√©d√©' && parseFloat(i["Purchase price"]) > 0)
                    .sort((a,b) => parseFloat(b["Purchase price"]) - parseFloat(a["Purchase price"]));
                
                if(sorted.length > 0) {
                    const top = sorted[0];
                    topItemName = top.Name;
                    const locale = currentLang === 'fr' ? 'fr-FR' : 'en-US';
                    const currency = currentLang === 'fr' ? 'EUR' : 'USD';
                    topItemPrice = parseFloat(top["Purchase price"]).toLocaleString(locale, {style:'currency', currency:currency});
                }
            }
            
            document.getElementById('story-top-name').innerText = topItemName;
            document.getElementById('story-top-price').innerText = topItemPrice;

            // Date
            document.getElementById('story-date').innerText = new Date().toLocaleDateString('en-GB');

            // 3. G√©n√©rer l'image sur fond NOIR (#0f0f0f)
            try {
                const element = document.getElementById("story-container");
                const canvas = await html2canvas(element, { 
                    scale: 1, 
                    useCORS: true, 
                    backgroundColor: "#0f0f0f" 
                });
                const link = document.createElement('a');
                link.download = `Hirono_Stats_Dark_${Date.now()}.jpg`;
                link.href = canvas.toDataURL("image/jpeg", 0.9);
                link.click();
            } catch (err) {
                console.error(err);
                alert("Error generating image.");
            } finally {
                btn.innerText = originalText;
            }
        };
        // Dans votre balise <script type="module">
onAuthStateChanged(auth, async (user) => {
    const btn = document.getElementById('auth-trigger');
    updateUIText(); // Met √† jour les textes FR/EN

    if (user) {
        // --- UTILISATEUR CONNECT√â ---
        if(btn) {
            btn.classList.add('logged-in');
            btn.onclick = () => window.location.href = "compte.html";
        }

        // 1. Charger les donn√©es (seulement si on est sur une page √† donn√©es)
        if (typeof loadUserData === "function") {
            await loadUserData(user); 
        }

        // 2. Afficher le contenu
        document.getElementById('main-container').style.setProperty('display', 'block', 'important');
        document.getElementById('access-denied').style.setProperty('display', 'none', 'important');

    } else {
        // --- UTILISATEUR D√âCONNECT√â ---
        if(btn) {
            btn.classList.remove('logged-in');
            btn.onclick = () => window.toggleAuthModal();
        }
        
        document.getElementById('access-denied').style.setProperty('display', 'flex', 'important');
        document.getElementById('main-container').style.setProperty('display', 'none', 'important');
    }

    // --- FINALISATION ---
    // Cette ligne est la cl√© : on ne montre le body qu'ici, 
    // une fois que le bon bloc a √©t√© choisi.
    document.body.classList.add('auth-ready');
});
const canvas = document.getElementById('snow-canvas');
const ctx = canvas.getContext('2d');

let width, height, snowflakes;

function initSnow() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    snowflakes = [];
    // Ajuste le nombre de flocons ici (150 est un bon √©quilibre)
    for (let i = 0; i < 150; i++) {
        snowflakes.push({
            x: Math.random() * width,
            y: Math.random() * height,
            radius: Math.random() * 3 + 1,
            speed: Math.random() * 1 + 0.5,
            wind: Math.random() * 0.5 - 0.25,
            opacity: Math.random() * 0.5 + 0.3
        });
    }
}

function drawSnow() {
    ctx.clearRect(0, 0, width, height);
    ctx.fillStyle = "white";
    
    snowflakes.forEach(flake => {
        ctx.beginPath();
        ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
        ctx.globalAlpha = flake.opacity;
        ctx.fill();

        // D√©placement
        flake.y += flake.speed;
        flake.x += flake.wind;

        // Si le flocon sort en bas, il r√©appara√Æt en haut
        if (flake.y > height) {
            flake.y = -10;
            flake.x = Math.random() * width;
        }
    });

    requestAnimationFrame(drawSnow);
}

window.addEventListener('resize', initSnow);

// Lancement
initSnow();
drawSnow();
    </script>
</body>
</html>